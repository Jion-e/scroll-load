/*! scroll-load tianxiangbing http://www.lovewebgames.com/jsmodule/scroll-load.html 2015-03-27 */
function ScrollLoad(){this.container,this.url,this.param,this.page=1,this.pagename="page",this.loadmore}ScrollLoad.prototype={init:function(a){this.settings=$.extend({},a),this.load=this.settings.loadmore||$('<div class="ui-loading">点击加载更多</div>'),this.container=this.settings.container,0==this.container.children().size()&&this.container.append('<div class="scroll-content"/>'),this.container.append(this.load),this.url=this.settings.url,this.page=this.settings.page||1,this.pagename=a.pagename||"page",this.param=$.extend({},this.settings.param),this.param[this.pagename]=this.page,this.bindEvent(),this.checkPosition()},touch:function(a,b){var c;$(a).on("click",b),$(a).on("touchmove",function(){c=!0}).on("touchend",function(a){if(a.preventDefault(),!c){var d=b.call(this,a,"touch");d||(a.preventDefault(),a.stopPropagation())}c=!1})},bindEvent:function(){if(this.container.size()){var a=this;$(window).scroll(function(){a.checkPosition()}),a.touch(a.load,function(){a.ajaxData()})}},checkPosition:function(){var a=this.container.offset(),b=this.container.height(),c=window.innerHeight||document.documentElement.clientHeight,d=(window.innerWidth||document.documentElement.clientWidth,document.body.scrollTop||document.documentElement.scrollTop),e=this;a.top+b<=c+d&&e.ajaxData()},ajaxData:function(){var a=this;return a.ajax?!1:(a.ajax=!0,this.load.html("正在加载中..."),this.param[this.pagename]=this.page,void $.ajax({url:a.url,type:a.settings.type||"get",dataType:"json",cache:!1,data:a.param,timeout:3e4,success:function(b){a.settings.format?a.settings.format(this.container,b):a.format(b),a.page++},complete:function(){setTimeout(function(){a.ajax=!1},1e3),a.load.html("点击加载更多")}}))},format:function(a){a.data&&a.data.length||(a.nodata=!0,this.load.remove());var b="string"==typeof this.settings.tpl?$(this.settings.tpl):this.settings.tpl,c=b.html(),d=Handlebars.compile(c),e=d(a);this.container.children().first().append(e),this.settings.callback&&this.settings.callback(this.container,a)}},function(a){a.fn.ScrollLoad=function(b){var c=[];return a(this).each(function(){var d=new ScrollLoad,e=a.extend({container:a(this)},b);d.init(e),c.push(d)}),c}}($);